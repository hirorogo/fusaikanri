<!-- filepath: /Users/hiro/Documents/fusaikanri/README.md -->
# fusaikanri
Discord server上で負債を管理するためのbot

## 主な機能

- 借金の記録と管理
- ユーザー間の貸し借り履歴の追跡
- 負債の一覧表示
- 返済記録の管理
- 負債の移動
- データの永続的な保存

## セットアップ

### 必要要件
- Python 3.8以上
- Discordボットトークン
- Discord Developer Portalでのボット作成

### インストール手順

1. リポジトリをクローン
```bash
git clone https://github.com/hirorogo/fusaikanri.git
cd fusaikanri
```

2. 依存関係をインストール
```bash
pip install -r requirements.txt
```

3. 環境変数を設定
```bash
cp .env.example .env
# .envファイルを編集してDISCORD_TOKENを設定
```

4. ボットを起動
```bash
python bot.py
```

## 使用方法

### 基本コマンド

#### 確認コマンド
- `/ping` - ボットの応答確認
- `/hello` - 挨拶

#### 借金管理コマンド
- `/set channel` - logを流すチャンネルを設定
- `/debt add <相手> <金額> [説明（任意）]` - 新しい借金を記録
- `/debt list` - 自分の借金一覧を表示
- `/debt pay <相手> <金額>` - 返済を記録
- `/debt status <相手>` - 特定のユーザーとの収支を確認
- `/debt history` - 取引履歴を表示

#### 債権譲渡コマンド（オプション機能）
- `/debt transfer <債務者> <譲渡先> <金額>` - 債権を他のユーザーに譲渡

### 使用例

```
# 借金を追加
/debt add @ユーザー名 1000 ランチ代

# 借金の確認
/debt list

# 返済を記録
/debt pay @ユーザー名 500

# 収支の確認
/debt status @ユーザー名
```

### 債権譲渡機能について

債権譲渡機能を使うと、自分が持っている債権（貸している分）を他のユーザーに譲渡できます。


#### 債権譲渡の使い方

**状況例:**
- Aさん → Bさんに3000円貸している
- AさんがCさんに1000円分の債権を譲渡したい

```
/debt transfer @Bさん @Cさん 1000
```

**結果:**
- Aさん → Bさんへの債権: 3000円 → 2000円
- Cさん → Bさんへの債権: 0円 → 1000円

**ログ例:**
```
@Aさんは@Cさんに債権1000円を譲渡した！
@Bさんは@Cさんに1000円返せよな！
（@Aさんの残債権: 2000円）
```

#### エラー例

```
# 機能が無効の場合
エラー: 債権譲渡機能が無効だぞ！
/debt config transfer enable で有効化してくれ

# 債権が存在しない場合
エラー: @Bさんへの債権がないぞ！

# 債権額不足の場合
エラー: @Bさんへの債権は2000円しかないぞ！
```

### ログ例

**借金したときの動作:**
```
@〇〇は〇〇から〇〇円借金した！
累計〇〇円の借金はよ返せよな！
```

**借金返済したときの動作:**
```
@〇〇は〇〇に〇〇円返済した！
残りの借金は〇〇円だぞ！
```

## データ管理

- データはローカルのJSONファイルまたはSQLiteデータベースに保存されます
- データファイルは `data/` ディレクトリに保存されます
- 定期的なバックアップを推奨します

## ファイル構成

```
fusaikanri/
├── bot.py                    # メインのボットファイル
├── config.py                 # 設定管理
├── requirements.txt          # Python依存関係
├── .env.example              # 環境変数のテンプレート
├── .github/
│   └── copilot-instructions.md  # GitHub Copilotの指示ファイル
├── cogs/                     # コマンドモジュール
│   └── debt.py               # 借金管理コマンド
├── utils/                    # ヘルパー関数
│   └── database.py           # データベース操作
└── data/                     # データ保存ディレクトリ
    └── debts.json            # 借金データ
```

## 開発

### 開発環境
- Python 3.8以上
- discord.py 2.0以上
- M2 MacBook推奨

### コーディング規約
- PEP 8に準拠
- 日本語でコメントを記述
- インデントはスペース2つ
- 型ヒントを使用
- 各関数にdocstringを記述

### テスト
開発用Discordサーバーでコマンドをテストしてください。

```bash
# テストサーバーでボットを起動
python bot.py
```

## トラブルシューティング

### ボットが起動しない
- `.env`ファイルにDISCORD_TOKENが正しく設定されているか確認
- 依存関係が正しくインストールされているか確認

### コマンドが反応しない
- ボットに適切な権限が付与されているか確認
- インテント設定が正しいか確認

### データが保存されない
- `data/`ディレクトリの書き込み権限を確認
- ディスク容量を確認

## セキュリティ

- ボットトークンは絶対にリポジトリにコミットしない
- `.env`ファイルは`.gitignore`に追加済み
- 本番環境では適切な権限管理を実施

## ライセンス

MIT License

## 貢献

プルリクエストを歓迎します。大きな変更の場合は、まずissueを開いて変更内容を議論してください。

## 作者

hiro ([@hirorogo](https://github.com/hirorogo))

## 更新履歴

- 2026-01-06: 初回リリース